"use strict";var API_KEY="e9f6322f77334e3f0406d6b8eabd79ce",BASE_URL="https://api.themoviedb.org/3",refs={homePageContainer:document.querySelector("div.home-page"),searchForm:document.querySelector(".search-form"),searchInput:document.querySelector('input[name="search"]'),filmsContainer:document.querySelector(".js_films_list"),paginationPage:document.querySelector(".pagination_page"),btnNext:document.querySelector('[data-id="next"]'),btnPrev:document.querySelector('[data-id="prev"]')},filmsInfo={page:1,value:"",incrementPage:function(){this.page+=1},decrementPage:function(){this.page-=1},resetPage:function(){this.page=1}};function fetchPopularMoviesList(){filmsInfo.value="",enablePreloader(),fetch("".concat(BASE_URL,"/movie/popular?api_key=").concat(API_KEY,"&page=").concat(filmsInfo.page)).then(function(e){return e.json()}).then(function(e){disablePreloader(),refs.filmsContainer.innerHTML="",createCardFunc(e.results)})}function fetchFilms(){enablePreloader(),fetch("".concat(BASE_URL,"/search/movie?api_key=").concat(API_KEY,"&query=").concat(filmsInfo.value,"&page=").concat(filmsInfo.page)).then(function(e){return e.json()}).then(function(e){if(disablePreloader(),0<e.results.length)refs.filmsContainer.innerHTML="",createCardFunc(e.results),refs.searchInput.value="";else{var t=document.createElement("div");t.classList.add("error"),t.textContent="No results found ðŸ˜”",refs.homePageContainer.insertBefore(t,refs.filmsContainer),setTimeout(function(){t.remove()},3e3)}})}function searchFilms(e){e.preventDefault(),filmsInfo.resetPage(),filmsInfo.value=refs.searchInput.value,fetchFilms()}function createCardFunc(e){e.map(function(e){var t='\n  <li data-id="'.concat(e.id,'" class="films_list-item">\n    <img \n      src="https://image.tmdb.org/t/p/w500').concat(e.backdrop_path,'"\n      alt="').concat(e.title,' image"\n      class="films_list-item-image"\n    >\n    <h3 class="films_list-item-title">').concat(e.title," (<span>").concat(e.release_date,"</span>)</h3>\n  </li>\n  ");refs.filmsContainer.insertAdjacentHTML("beforeend",t)})}function paginationNavigation(e){"next"===e.target.dataset.id?(filmsInfo.incrementPage(),refs.paginationPage.textContent=filmsInfo.page,(refs.filmsContainer.innerHTML="")===filmsInfo.value?fetchPopularMoviesList():fetchFilms(),refs.btnPrev.disabled=!1):"prev"===e.target.dataset.id&&(filmsInfo.decrementPage(),refs.paginationPage.textContent=filmsInfo.page,(refs.filmsContainer.innerHTML="")===filmsInfo.value?fetchPopularMoviesList():fetchFilms(),filmsInfo.page<=1?refs.btnPrev.disabled=!0:refs.btnPrev.disabled=!1)}document.addEventListener("DOMContentLoaded",fetchPopularMoviesList),refs.searchForm.addEventListener("submit",searchFilms),refs.btnNext.addEventListener("click",paginationNavigation),refs.btnPrev.addEventListener("click",paginationNavigation),refs.filmsContainer.addEventListener("click",openClickedFilm),refs.paginationPage.textContent=filmsInfo.page;var homeBtn=document.querySelector(".home"),libraryBtn=document.querySelector(".library"),logoLink=document.getElementById("navigation-logo"),preloader=document.querySelector(".preloader-wrapper");libraryBtn.addEventListener("click",activeLibraryPage),homeBtn.addEventListener("click",activeHomePage),logoLink.addEventListener("click",resetAll);var homePage=document.querySelector(".home-page"),detailsPage=document.querySelector(".details_page"),libraryPage=document.getElementById("library-page");function activeHomePage(){libraryBtn.classList.remove("nav__btn-active"),homeBtn.classList.add("nav__btn-active"),homePage.style.display="block",libraryPage.style.display="none",detailsPage.style.display="none"}function activeLibraryPage(){homeBtn.classList.remove("nav__btn-active"),libraryBtn.classList.add("nav__btn-active"),libraryPage.style.display="block",homePage.style.display="none",detailsPage.style.display="none",showQueue()}function resetAll(){activeHomePage(),fetchPopularMoviesList()}function enablePreloader(){document.body.style.opacity="0.5",preloader.style.display="block"}function disablePreloader(){document.body.style.opacity="1",preloader.style.display="none"}var selectedFilm,watched=document.querySelector(".btn-addWatch"),queue=document.querySelector(".btn-addQueue"),infoFilmsQueue=JSON.parse(localStorage.getItem("filmsQueue")),infoFilmsWatched=JSON.parse(localStorage.getItem("filmsWatched"));infoFilmsQueue||(infoFilmsQueue=[]),infoFilmsWatched||(infoFilmsWatched=[]);var titleFilm=document.querySelector(".title-moive"),blockImg=(homePage=document.querySelector(".home-page"),libraryPage=document.querySelector(".library-page"),detailsPage=document.querySelector(".details_page"),document.querySelector(".details-block__block-img")),listInfo=document.querySelector(".details-block__info--tech-info"),descriptionBlock=document.querySelector(".details-block__info--about");function openClickedFilm(e){if("LI"===e.target.nodeName||"H3"===e.target.nodeName){homePage.style.display="none",libraryPage.style.display="none",detailsPage.style.display="block";var t=e.target.closest(".films_list-item");enablePreloader(),fetch("".concat(BASE_URL,"/movie/").concat(t.dataset.id,"?api_key=").concat(API_KEY)).then(function(e){return e.json()}).then(function(e){disablePreloader(),renderDetailsPage(selectedFilm=e),monitorButtonStatusText("filmsWatched"),monitorButtonStatusText("filmsQueue")})}}function renderDetailsPage(e){blockImg.firstChild.src="https://image.tmdb.org/t/p/w500".concat(e.poster_path),titleFilm.innerHTML=e.title,listInfo.children[0].lastElementChild.innerText="".concat(e.vote_average," / ").concat(e.vote_count),listInfo.children[1].lastElementChild.innerText=e.popularity,listInfo.children[2].lastElementChild.innerText=e.original_title,listInfo.children[3].lastElementChild.innerText=e.genres.map(function(e){return e.name}).join(", "),listInfo.children[4].lastElementChild.innerText=e.production_companies.map(function(e){return e.name}).join(", "),descriptionBlock.lastElementChild.innerText=e.overview}function toggleToQueue(){var e=infoFilmsQueue.find(function(e){return e.id===selectedFilm.id});if(e){var t=infoFilmsQueue.indexOf(e);infoFilmsQueue.splice(t,1)}else infoFilmsQueue.push(selectedFilm);localStorage.setItem("filmsQueue",JSON.stringify(infoFilmsQueue)),monitorButtonStatusText("filmsQueue")}function toggleToWatched(){var e=infoFilmsWatched.find(function(e){return e.id===selectedFilm.id});if(e){var t=infoFilmsWatched.indexOf(e);infoFilmsWatched.splice(t,1)}else infoFilmsWatched.push(selectedFilm);localStorage.setItem("filmsWatched",JSON.stringify(infoFilmsWatched)),monitorButtonStatusText("filmsWatched")}function monitorButtonStatusText(e){var t=infoFilmsQueue.find(function(e){return e.id===selectedFilm.id}),i=infoFilmsWatched.find(function(e){return e.id===selectedFilm.id});switch(e){case"filmsQueue":queue.innerText=t?"Delete from queue":"Add to queue",queue.style.backgroundImage=t?"url(./images/trash_icon.png)":"url(./images/queue1.png)";break;case"filmsWatched":watched.innerText=i?"Delete from watched":"Add to watched",watched.style.backgroundImage=i?"url(./images/trash_icon.png)":"url(./images/logo-blackCopy.png)"}}queue.addEventListener("click",toggleToQueue),watched.addEventListener("click",toggleToWatched);var libraryRefs={watchedBtn:document.getElementById("watched-btn"),queueBtn:document.getElementById("watch-later-btn"),libraryList:document.getElementById("library-list"),libraryStub:document.getElementById("library-stub")};function showWatchedMovies(){libraryRefs.queueBtn.classList.remove("active"),libraryRefs.watchedBtn.classList.add("active"),0!==infoFilmsWatched.length?(libraryRefs.libraryList.innerHTML="",libraryRefs.libraryList.style.display="flex",libraryRefs.libraryStub.style.display="none",createMarkupForLibrary(infoFilmsWatched)):(libraryRefs.libraryList.style.display="none",libraryRefs.libraryStub.style.display="flex")}function showQueue(){libraryRefs.watchedBtn.classList.remove("active"),libraryRefs.queueBtn.classList.add("active"),0!==infoFilmsQueue.length?(libraryRefs.libraryList.innerHTML="",libraryRefs.libraryList.style.display="flex",libraryRefs.libraryStub.style.display="none",createMarkupForLibrary(infoFilmsQueue)):(libraryRefs.libraryList.style.display="none",libraryRefs.libraryStub.style.display="flex")}function createMarkupForLibrary(e){var t=e.reduce(function(e,t){return e+='<li data-id="'.concat(t.id,'" class="films_list-item">\n              <img\n                src="https://image.tmdb.org/t/p/w500').concat(t.backdrop_path,'"\n                alt="').concat(t.original_title,' image"\n                class="films_list-item-image"\n              />\n              <h3 class="films_list-item-title">\n                ').concat(t.original_title," (<span>").concat(t.release_date,'</span>)\n              </h3>\n              <p class="films_list-item-rating">').concat(t.vote_average,"</p>\n            </li>")},"");libraryRefs.libraryList.insertAdjacentHTML("beforeend",t)}libraryRefs.watchedBtn.addEventListener("click",showWatchedMovies),libraryRefs.queueBtn.addEventListener("click",showQueue),libraryRefs.libraryList.addEventListener("click",openClickedFilm),libraryRefs.queueBtn.classList.add("active");